









    
    
    
    



    










<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Sml Python Small Library Reference - Office for National Statistics</title>
        <link rel="stylesheet" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/css/main.css">
        <link rel="stylesheet" media="print" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/css/print.css">
        <meta name="theme-color" content="#206095"/>
        
            
                
                    <meta name="description" content="/">
                

                <!-- Canonical -->
                <link rel="canonical" href="/">

                
            
        

        
            <!-- Open Graph -->
            <meta property="og:type" content="website">
            <meta property="og:url" content="/">
            <meta property="og:title" content="Sml Python Small Library Reference - Office for National Statistics">
            <meta property="og:image" content="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/favicons/opengraph.png">
            <meta property="og:image:type" content="image/png">
            <meta property="og:image:width" content="1200">
            <meta property="og:image:height" content="630">
            <meta property="og:description" content="/">
            <meta property="og:site_name" content="Sml Python Small Library Reference">
            <meta property="og:locale" content="en">

            

            
        

        
            <!-- Favicons -->
            <link rel="icon" type="image/x-icon" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/favicons/favicon.ico">
            <link rel="icon" type="image/png" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/favicons/favicon-32x32.png" sizes="32x32">
            <link rel="icon" type="image/png" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/favicons/favicon-16x16.png" sizes="16x16">
            <link rel="mask-icon" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/favicons/safari-pinned-tab.svg" color="#000000">
            <link rel="apple-touch-icon" type="image/png" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/favicons/apple-touch-icon.png" sizes="180x180">
            <link rel="manifest" href="https://cdn.ons.gov.uk/sdc/design-system/62.0.0/favicons/manifest.json">
        

        

    </head>
    <body>
        <script>document.body.className = ((document.body.className) ? document.body.className + ' ons-js-enabled' : 'ons-js-enabled');</script>
        
        
            <div class="ons-page">
                <div class="ons-page__content">
                    
                    
                    
                        
    <a class="ons-skip-link" href="#main-content">Skip to main content</a>

                    
                    
                        
    
    
    
    

    
    

    

    <header class="ons-header " role="banner">
        
    
        
        
        
    

    <div class="ons-browser-banner">
        <div class="ons-container">
            <p class="ons-browser-banner__content"><span class="ons-browser-banner__lead">This website no longer supports your browser.</span><span class="ons-browser-banner__cta"> You can <a class="ons-browser-banner__link" href="https://www.ons.gov.uk/help/browsers">upgrade your browser to the latest version</a>.</span></p>
        </div>
    </div>

        
        <div class="ons-header__top">
            <div class="ons-container">
                <div class="ons-header__grid-top ons-grid ons-grid--gutterless ons-grid--flex ons-grid--between ons-grid--vertical-center ons-grid--no-wrap">
                    <div class="ons-grid__col ons-col-auto"><div class="ons-header__org-logo ons-header__org-logo--large">
                            
                                

    

    
    
        <svg class="ons-svg-logo" xmlns="http://www.w3.org/2000/svg" width="197" height="19" viewBox="33 2 552 60" aria-labelledby="ons-logo-en-alt">
            <title id="ons-logo-en-alt">Office for National Statistics logo</title>
            <g class="ons-svg-logo__group ons-svg-logo__group--secondary" fill="#a8bd3a">
                <path d="M0,34.6c.8-1.69,1.39-3,2.32-4.6A38.28,38.28,0,0,1,0,23.4V34.6M5,3S0,3,0,9.25v1A62.12,62.12,0,0,0,4.2,27a43.77,43.77,0,0,1,9.42-10.79C21.69,9.21,31.16,5.13,45.9,3Z"/>
            </g>
            <g class="ons-svg-logo__group ons-svg-logo__group--primary" fill="#003c57">
                <path d="M53.06,6.42C36.2,8,24.68,12.92,16.43,20.07A41.46,41.46,0,0,0,6.4,32.2C12.87,44.93,28.88,57,46.6,57H47s6.32.21,6.32-6.91V6.36a1.22,1.22,0,0,1-.26.06M9.72,42.67a44.25,44.25,0,0,1-5-7.42A80.59,80.59,0,0,0,0,46.38V56.91L31.06,57c-9.83-3-15.74-7.64-21.34-14.3"/>
            </g>
            <g class="ons-svg-logo__group ons-svg-logo__group--text" fill="#003c57">
                <path d="M82,47.49c-9.07,0-13.13-7.51-13.13-16.77S72.91,14,82,14s13.1,7.61,13.1,16.77S91.1,47.54,82,47.54m0-30.91c-6.69,0-9.07,7.33-9.07,14.05s2.16,13.9,9.07,13.9,9-7.28,9-13.9-2.34-14-9-14"/>
                <path d="M106.36,23.81V46.88h-3.67V23.81H98.93V21.56h3.76V17.9c0-4.61,2.72-7.95,8.08-7.95.38,0,.86.05.86.05v2.35h-.43c-2.55,0-4.84,1.64-4.84,5.12v4.09h5.27v2.25Z"/>
                <path d="M121.53,23.81V46.88h-3.67V23.81H114.1V21.56h3.76V17.9c0-4.61,2.72-7.95,8.08-7.95.38,0,.86.05.86.05v2.35h-.43c-2.55,0-4.84,1.64-4.84,5.12v4.09h5.27v2.25Z"/>
                <path d="M132.85,16.72a2.28,2.28,0,0,1-2.33-2.23v0a2.34,2.34,0,0,1,4.67,0,2.28,2.28,0,0,1-2.3,2.26h0M131,21.56h3.71V46.88H131Z"/>
                <path d="M150.53,47.49c-6,0-10.63-5.16-10.63-13.29S144.52,21,150.66,21a9.76,9.76,0,0,1,6.17,1.74l-1,2.25a7.53,7.53,0,0,0-4.4-1.36c-5.15,0-7.78,4.46-7.78,10.48,0,6.2,3,10.62,7.65,10.62a8,8,0,0,0,4.49-1.37l1,2.45a10.21,10.21,0,0,1-6.3,1.73"/>
                <path d="M162.84,35.75c.48,6,3.76,9,8.9,9a14.66,14.66,0,0,0,6.88-1.55l1.08,2.59a18,18,0,0,1-8.22,1.73c-7.12,0-12.18-4.23-12.18-13.34,0-8.69,4.67-13.2,11-13.2s10.37,3.95,10.37,12.4Zm7.35-12.41c-4.1,0-7.56,3.2-7.52,10.29l14.39-2c0-5.87-2.81-8.32-6.87-8.32"/>
                <path d="M198.57,23.81V46.88H194.9V23.81h-3.76V21.56h3.76V17.9c0-4.61,2.72-7.95,8.08-7.95.39,0,.87.05.87.05v2.35h-.44c-2.54,0-4.84,1.64-4.84,5.12v4.09h5.28v2.25Z"/>
                <path d="M217.28,47.49c-7.47,0-10.89-5.78-10.89-13.24S209.81,21,217.28,21s10.85,5.82,10.85,13.3-3.37,13.24-10.85,13.24m0-24c-5.53,0-7.13,5.59-7.13,10.81s1.73,10.56,7.13,10.56,7.13-5.35,7.13-10.56-1.6-10.81-7.13-10.81"/>
                <path d="M244.08,23.91c-2.34-.61-5.75-.52-7.35.47v22.5H233V22.69c2.67-1.13,5.36-1.74,10.11-1.74H245Z"/>
                <path d="M277.42,47.13,263.07,25a32.2,32.2,0,0,1-1.85-3.29h-.09s.13,1.88.13,3.85V47.13h-4.71V14.8h5.31l13.61,20.82A28.76,28.76,0,0,1,277.38,39h.08s-.17-1.84-.17-3.77V14.8H282V47.13Z"/>
                <path d="M297.52,47.79c-7.43,0-10.93-3-10.93-7.81,0-6.8,7.12-8.64,15.59-9.39V29.13c0-3.47-2.37-4.51-5.83-4.51a18,18,0,0,0-6.87,1.46L288.23,23a24,24,0,0,1,9.12-1.83c5.61,0,9.93,2.3,9.93,8.78V46a22.71,22.71,0,0,1-9.76,1.83m4.66-14.67c-6.26.67-10.45,1.84-10.45,6.73,0,3.42,2.42,4.88,6.22,4.88a10.09,10.09,0,0,0,4.23-.84Z"/>
                <path d="M322,47.69c-5.31,0-7.34-3.43-7.34-6.86V25.09h-3.55V21.81h3.55V16.12l5.4-1.5v7.19H325v3.28h-5V40.55a3.26,3.26,0,0,0,3,3.52h.5a5.5,5.5,0,0,0,1.46-.23v3.33a7.69,7.69,0,0,1-3,.52"/>
                <path d="M331.91,17.43a3,3,0,0,1-3.15-2.81,3.17,3.17,0,0,1,6.31,0,3,3,0,0,1-3.16,2.81m-2.72,4.38h5.44V47.13h-5.44Z"/>
                <path d="M350.88,47.79c-7.73,0-11.57-5.74-11.57-13.3s3.84-13.34,11.57-13.34,11.54,5.78,11.54,13.34-3.8,13.3-11.54,13.3m0-23.17c-4.66,0-6.05,4.89-6.05,9.82s1.47,9.63,6.05,9.63,6.05-4.7,6.05-9.63-1.38-9.82-6.05-9.82"/>
                <path d="M382.52,47.13V29c0-3.24-2.77-4.47-5.88-4.47a12.3,12.3,0,0,0-4.37.76v21.8h-5.39V23a26.81,26.81,0,0,1,10.06-1.83c6.61,0,11,2.25,11,7.8V47.13Z"/>
                <path d="M403.18,47.79c-7.43,0-10.94-3-10.94-7.81,0-6.8,7.13-8.64,15.6-9.39V29.13c0-3.47-2.37-4.51-5.83-4.51a18,18,0,0,0-6.87,1.46L393.89,23A24,24,0,0,1,403,21.15c5.62,0,9.94,2.3,9.94,8.78V46a22.71,22.71,0,0,1-9.76,1.83m4.66-14.67c-6.27.67-10.46,1.84-10.46,6.73,0,3.42,2.43,4.88,6.23,4.88a10.09,10.09,0,0,0,4.23-.84Z"/>
                <polygon points="418.52 47.13 418.52 34.91 418.52 10.25 423.92 10.25 423.92 22.76 423.92 47.13 418.52 47.13"/>
                <path d="M445.39,47.79A19.11,19.11,0,0,1,436.58,46l1.51-4a13.48,13.48,0,0,0,6.22,1.55c3.76,0,6.44-2.21,6.44-5.41,0-7.09-13.44-4.36-13.44-14.42,0-5.13,4.15-9.59,10.72-9.59A15.82,15.82,0,0,1,455.8,16l-1.38,3.52a11.93,11.93,0,0,0-5.66-1.5c-3.5,0-5.79,2.11-5.79,5.12,0,7,13.74,3.94,13.74,14.65,0,5.74-4.71,10-11.32,10"/>
                <path d="M470.41,47.69c-5.31,0-7.34-3.43-7.34-6.86V25.09h-3.54V21.81h3.54V16.12l5.4-1.5v7.19h4.92v3.28h-4.92V40.55a3.27,3.27,0,0,0,3,3.52h.48a5.12,5.12,0,0,0,1.46-.23v3.33a7.69,7.69,0,0,1-3,.52"/>
                <path d="M487.27,47.79c-7.44,0-10.93-3-10.93-7.81,0-6.8,7.13-8.64,15.6-9.39V29.13c0-3.47-2.38-4.51-5.84-4.51a18,18,0,0,0-6.87,1.46L478,23a23.94,23.94,0,0,1,9.11-1.83c5.62,0,9.94,2.3,9.94,8.78V46a22.71,22.71,0,0,1-9.76,1.83M492,33.16c-6.27.67-10.46,1.84-10.46,6.73,0,3.42,2.42,4.88,6.22,4.88a10,10,0,0,0,4.24-.84Z"/>
                <path d="M511.73,47.69c-5.32,0-7.35-3.43-7.35-6.86V25.09h-3.54V21.81h3.54V16.12l5.4-1.5v7.19h4.92v3.28h-4.92V40.55a3.26,3.26,0,0,0,3,3.52h.5a5.5,5.5,0,0,0,1.46-.23v3.33a7.69,7.69,0,0,1-3,.52"/>
                <path d="M521.66,17.43a3,3,0,0,1-3.15-2.81,3.17,3.17,0,0,1,6.31,0,3,3,0,0,1-3.16,2.81m-2.72,4.38h5.45V47.13h-5.45Z"/>
                <path d="M536.19,47.79A15.9,15.9,0,0,1,528.54,46L530,42.48a10.53,10.53,0,0,0,5.52,1.5c2.77,0,5-1.78,5-3.94,0-6-11.1-3.2-11.1-11.47,0-3.76,3.37-7.42,8.86-7.42A13.56,13.56,0,0,1,545.34,23l-1.42,3.14a8.47,8.47,0,0,0-4.62-1.45c-2.81,0-4.54,1.69-4.54,3.62,0,5.64,11.32,3.14,11.32,11.6,0,4-3.85,7.9-9.89,7.9"/>
                <path d="M559.83,47.69c-5.31,0-7.35-3.43-7.35-6.86V25.09h-3.54V21.81h3.54V16.12l5.4-1.5v7.19h4.93v3.28h-4.93V40.55a3.27,3.27,0,0,0,3,3.52h.48a5.64,5.64,0,0,0,1.47-.23v3.33a7.72,7.72,0,0,1-3,.52"/>
                <path d="M569.77,17.43a3,3,0,0,1-3.15-2.81,3.17,3.17,0,0,1,6.31,0,3,3,0,0,1-3.16,2.81m-2.72,4.38h5.44V47.13h-5.44Z"/>
                <path d="M588.14,47.79c-6.23,0-11-5.08-11-13.35s4.88-13.29,11-13.29A10.51,10.51,0,0,1,594.66,23l-1.21,3a6.87,6.87,0,0,0-4-1.22c-4.4,0-6.69,3.81-6.69,9.49s2.63,9.59,6.61,9.59a6.74,6.74,0,0,0,4-1.28L594.7,46c-1.12.94-3.33,1.84-6.56,1.84"/>
                <path d="M605.1,47.79A15.9,15.9,0,0,1,597.45,46l1.42-3.47A10.54,10.54,0,0,0,604.4,44c2.77,0,5-1.78,5-3.94,0-6-11.1-3.2-11.1-11.47,0-3.76,3.37-7.42,8.85-7.42a13.49,13.49,0,0,1,7.1,1.83l-1.42,3.14a8.42,8.42,0,0,0-4.63-1.45c-2.8,0-4.53,1.69-4.53,3.62,0,5.64,11.32,3.14,11.32,11.6,0,4-3.85,7.9-9.89,7.9"/>
            </g>
        </svg>
    

                            
                        </div>
                        <div class="ons-header__org-logo ons-header__org-logo--small">
                            
                                

    

    
    
        <svg class="ons-svg-logo" xmlns="http://www.w3.org/2000/svg" width="120" height="27" viewBox="0 5 595 116" aria-labelledby="ons-logo-stacked-en-alt">
            <title id="ons-logo-stacked-en-alt">Office for National Statistics logo</title>
            <g class="ons-svg-logo__group ons-svg-logo__group--secondary" fill="#a8bd3a">
                <path d="M0,70.5c1.8-3.7,3.6-7.2,5.6-10.7A127.94,127.94,0,0,1,0,42.6V70.5M10.9,0S0,0,0,13.5v7.2A128.06,128.06,0,0,0,7.9,56.2a114.75,114.75,0,0,1,22.3-26C47.8,15.1,71.5,4.7,103.7.1Z"/>
            </g>
            <g class="ons-svg-logo__group ons-svg-logo__group--primary" fill="#003c57">
                <path d="M115.9,7.3c-36.8,3.5-62,14-80,29.4a108.15,108.15,0,0,0-23.6,29c14.1,27.4,41.1,47.6,86,50.5h4.4s13.8.5,13.8-14.9V7.2l-.6.1M21.2,85.4a92.68,92.68,0,0,1-11-16A173,173,0,0,0,0,93.4v22.7l73.6.1c-22.9-5.5-40.1-16.4-52.4-30.8"/>
            </g>
            <g class="ons-svg-logo__group ons-svg-logo__group--text" fill="#003c57">
                <path d="M161,51.9c-11.3,0-16.3-9.3-16.3-20.8s5-20.8,16.3-20.8,16.3,9.5,16.3,20.8c-.1,11.5-5.1,20.8-16.3,20.8m0-38.3c-8.3,0-11.3,9.1-11.3,17.4s2.7,17.3,11.3,17.3,11.2-9.1,11.2-17.3S169.3,13.6,161,13.6m30.2,8.9V51.2h-4.5V22.6H182V19.8h4.7V15.2c0-5.7,3.4-9.9,10-9.9a8,8,0,0,1,1.1.1V8.3h-.5c-3.2,0-6,2.1-6,6.4v5.1h6.6v2.8l-6.7-.1Zm18.9,0V51.2h-4.5V22.6h-4.7V19.8h4.7V15.2c0-5.7,3.4-9.9,10-9.9a8,8,0,0,1,1.1.1V8.3h-.5c-3.2,0-6,2.1-6,6.4v5.1h6.6v2.8l-6.7-.1Zm14-8.8a2.82,2.82,0,0,1-2.9-2.8,2.9,2.9,0,0,1,5.8,0,2.76,2.76,0,0,1-2.9,2.8m-2.3,6h4.6V51.2h-4.6Zm24.3,32.2c-7.4,0-13.2-6.4-13.2-16.5,0-10.3,5.8-16.5,13.4-16.5a12.36,12.36,0,0,1,7.7,2.2l-1.2,2.8a8.92,8.92,0,0,0-5.5-1.7c-6.4,0-9.7,5.5-9.7,13,0,7.7,3.7,13.2,9.5,13.2a9.8,9.8,0,0,0,5.6-1.7l1.2,3c-1.3,1.2-4,2.2-7.8,2.2m15.3-14.6c.6,7.4,4.7,11.1,11.1,11.1a18.36,18.36,0,0,0,8.5-1.9l1.3,3.2a22.58,22.58,0,0,1-10.2,2.1c-8.8,0-15.1-5.3-15.1-16.6,0-10.8,5.8-16.4,13.7-16.4s12.9,4.9,12.9,15.4l-22.2,3.1ZM270.5,22c-5.1,0-9.4,4-9.3,12.8l17.9-2.5C279,25,275.5,22,270.5,22m42.2.5V51.2h-4.5V22.6h-4.7V19.8h4.7V15.2c0-5.7,3.4-9.9,10-9.9a8,8,0,0,1,1.1.1V8.3h-.5c-3.2,0-6,2.1-6,6.4v5.1h6.6v2.8Zm23.2,29.4c-9.3,0-13.5-7.2-13.5-16.5s4.2-16.5,13.5-16.5,13.5,7.2,13.5,16.5-4.2,16.5-13.5,16.5m0-29.8c-6.9,0-8.8,7-8.8,13.4s2.1,13.1,8.8,13.1c6.9,0,8.9-6.6,8.9-13.1s-2-13.4-8.9-13.4m33.3.6c-2.9-.8-7.1-.6-9.1.6V51.2h-4.6V21.1c3.3-1.4,6.6-2.2,12.5-2.2h2.4c0,.1-1.2,3.8-1.2,3.8ZM171.3,114.8,153.5,87.3c-1.3-2.1-2.3-4.1-2.3-4.1h-.1s.2,2.3.2,4.8v26.8h-5.8V74.7h6.6L169,100.5a46.13,46.13,0,0,1,2.4,4.1h.1s-.2-2.3-.2-4.7V74.6h5.9v40.1l-5.9.1Zm25,.8c-9.2,0-13.6-3.7-13.6-9.7,0-8.5,8.8-10.7,19.4-11.7V92.4c0-4.3-2.9-5.6-7.2-5.6a22.34,22.34,0,0,0-8.5,1.8l-1.6-3.8a30.2,30.2,0,0,1,11.3-2.3c7,0,12.3,2.9,12.3,10.9v19.9c-2.7,1.4-6.9,2.3-12.1,2.3m5.8-18.2c-7.8.8-13,2.3-13,8.3,0,4.2,3,6.1,7.7,6.1a12.33,12.33,0,0,0,5.3-1.1Zm24.5,18.1c-6.6,0-9.1-4.3-9.1-8.5V87.5h-4.4V83.4h4.4v-7l6.7-1.9v8.9h6.1v4.1h-6.1v19.2c0,2.5,1.4,4.4,4.3,4.4a5.66,5.66,0,0,0,1.8-.3v4.1a11.47,11.47,0,0,1-3.7.6M239,77.9a3.52,3.52,0,1,1,3.9-3.5,3.71,3.71,0,0,1-3.9,3.5m-3.4,5.5h6.8v31.4h-6.8Zm26.9,32.2c-9.6,0-14.4-7.1-14.4-16.5s4.8-16.6,14.4-16.6,14.3,7.2,14.3,16.6-4.7,16.5-14.3,16.5m0-28.7c-5.8,0-7.5,6.1-7.5,12.2s1.8,11.9,7.5,11.9,7.5-5.8,7.5-11.9-1.7-12.2-7.5-12.2m39.3,27.9V92.3c0-4-3.4-5.5-7.3-5.5a16,16,0,0,0-5.4.9v27.1h-6.7v-30a32.8,32.8,0,0,1,12.5-2.3c8.2,0,13.7,2.8,13.7,9.7v22.6Zm25.7.8c-9.2,0-13.6-3.7-13.6-9.7,0-8.5,8.9-10.7,19.4-11.7V92.4c0-4.3-2.9-5.6-7.2-5.6a22.34,22.34,0,0,0-8.5,1.8L316,84.8a30.2,30.2,0,0,1,11.3-2.3c7,0,12.3,2.9,12.3,10.9v19.9c-2.7,1.4-6.9,2.3-12.1,2.3m5.8-18.2c-7.8.8-13,2.3-13,8.3,0,4.2,3,6.1,7.7,6.1a12.33,12.33,0,0,0,5.3-1.1Zm13.2,17.4V69h6.7v45.8Zm38.6.8a23.94,23.94,0,0,1-10.9-2.3l1.9-4.9a17,17,0,0,0,7.7,1.9c4.7,0,8-2.7,8-6.7,0-8.8-16.7-5.4-16.7-17.9,0-6.4,5.2-11.9,13.3-11.9a20.22,20.22,0,0,1,9.7,2.3l-1.7,4.4a14.57,14.57,0,0,0-7-1.9c-4.3,0-7.2,2.6-7.2,6.4,0,8.6,17.1,4.9,17.1,18.2-.1,7.1-6,12.4-14.2,12.4m31.1-.1c-6.6,0-9.1-4.3-9.1-8.5V87.5h-4.4V83.4h4.4v-7l6.7-1.9v8.9h6.1v4.1h-6.1v19.2a4.07,4.07,0,0,0,4.3,4.4,5.66,5.66,0,0,0,1.8-.3v4.1a12.06,12.06,0,0,1-3.7.6m20.9.1c-9.2,0-13.6-3.7-13.6-9.7,0-8.5,8.9-10.7,19.4-11.7V92.4c0-4.3-2.9-5.6-7.2-5.6a22.34,22.34,0,0,0-8.5,1.8l-1.6-3.8a30.2,30.2,0,0,1,11.3-2.3c7,0,12.3,2.9,12.3,10.9v19.9c-2.6,1.4-6.9,2.3-12.1,2.3m5.8-18.2c-7.8.8-13,2.3-13,8.3,0,4.2,3,6.1,7.7,6.1a12.33,12.33,0,0,0,5.3-1.1Zm24.6,18.1c-6.6,0-9.1-4.3-9.1-8.5V87.5H454V83.4h4.4v-7l6.7-1.9v8.9h6.1v4.1h-6.1v19.2a4.07,4.07,0,0,0,4.3,4.4,5.66,5.66,0,0,0,1.8-.3v4.1a12.69,12.69,0,0,1-3.7.6m12.3-37.6a3.52,3.52,0,1,1,3.9-3.5,3.65,3.65,0,0,1-3.9,3.5m-3.4,5.5h6.8v31.4h-6.8Zm21.4,32.2a19.46,19.46,0,0,1-9.5-2.3l1.8-4.3a13.21,13.21,0,0,0,6.9,1.9c3.4,0,6.2-2.2,6.2-4.9,0-7.5-13.8-4-13.8-14.2,0-4.7,4.2-9.2,11-9.2a16.21,16.21,0,0,1,8.8,2.3l-1.8,3.9a10.31,10.31,0,0,0-5.7-1.8c-3.5,0-5.6,2.1-5.6,4.5,0,7,14,3.9,14,14.4,0,4.9-4.7,9.7-12.3,9.7m29.4-.1c-6.6,0-9.1-4.3-9.1-8.5V87.5h-4.4V83.4h4.4v-7l6.7-1.9v8.9h6.1v4.1h-6.1v19.2c0,2.5,1.4,4.4,4.3,4.4a5.66,5.66,0,0,0,1.8-.3v4.1a12.06,12.06,0,0,1-3.7.6m12.3-37.6a3.52,3.52,0,1,1,3.9-3.5c.1,2-1.7,3.5-3.9,3.5m-3.3,5.5H543v31.4h-6.8Zm26.2,32.2c-7.7,0-13.6-6.3-13.6-16.6s6.1-16.5,13.7-16.5c3.9,0,6.6,1.1,8,2.3L569,88.6a8.61,8.61,0,0,0-4.9-1.5c-5.5,0-8.3,4.7-8.3,11.8s3.3,11.9,8.2,11.9a8.39,8.39,0,0,0,4.9-1.6l1.7,4.1c-1.5,1.2-4.2,2.3-8.2,2.3m20.6,0a19.46,19.46,0,0,1-9.5-2.3l1.8-4.3a13.21,13.21,0,0,0,6.9,1.9c3.4,0,6.2-2.2,6.2-4.9,0-7.5-13.8-4-13.8-14.2,0-4.7,4.2-9.2,11-9.2a16.85,16.85,0,0,1,8.9,2.3l-1.8,3.9A10.31,10.31,0,0,0,587,87c-3.5,0-5.6,2.1-5.6,4.5,0,7,14,3.9,14,14.4-.1,4.9-4.9,9.7-12.4,9.7"/>
            </g>
        </svg>
    

                            
                        </div>
                        
                    </div>
                    
                </div>
            </div>
            
        </div>
        <div class="ons-header__main">
            <div class="ons-container">
                <div class="ons-grid ons-grid--gutterless ons-grid--flex ons-grid--between ons-grid--vertical-center ons-grid--no-wrap">
                    <div class="ons-grid__col ons-col-auto ons-u-flex-shrink">
                        
                            
                                <div class="ons-header__title">Sml Python Small Library Reference</div>
                            
                        
                        
                    </div>

                    
                    
                </div>
            </div>
        </div>
        
    </header>

                    
                    
                        <div class="ons-page__container ons-container">
                            
                                
                            
                            <div class="ons-grid">
                                <div class="ons-grid__col ons-col-12@m ">
                                    <main id="main-content" class="ons-page__main ">
                                        
        <section class="p-md-5 section-content">
    <article>
        <p><div class="doc doc-object doc-module">


<a id="sml_small.date_adjustment"></a>
  <div class="doc doc-contents first">
  
      <p>For Copyright information, please see LICENCE.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.average_weekly_subfunction">
<code class="highlight language-python">average_weekly_subfunction(df_stage_five, average_weekly_questions_list, da_error_flag_col)</code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Applies the average weekly method to the input data.</p>
<p>:param  df_stage_five: The dataframe containing the data as processed to this point.
:param  average_weekly_questions_list: The names of the columns in the input dataframe to be processed by the
        average weekly method.
:param  da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.</p>
<p>:raises TypeError: If the input dataframe is not a DataFrame; If the average weekly questions list parameter is
        not a List.
:raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe; If
        columns referenced in average_weekly_questions_list parameter cannot be found in the input dataframe.</p>
<p>:return: A dataframe holding data with the average weekly method applied.</p>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def average_weekly_subfunction(
    df_stage_five: pd.DataFrame,
    average_weekly_questions_list: List,
    da_error_flag_col: str,
) -&gt; pd.DataFrame:
    """
    Applies the average weekly method to the input data.

    :param  df_stage_five: The dataframe containing the data as processed to this point.
    :param  average_weekly_questions_list: The names of the columns in the input dataframe to be processed by the
            average weekly method.
    :param  da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.

    :raises TypeError: If the input dataframe is not a DataFrame; If the average weekly questions list parameter is
            not a List.
    :raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe; If
            columns referenced in average_weekly_questions_list parameter cannot be found in the input dataframe.

    :return: A dataframe holding data with the average weekly method applied.

    """

    # Basic validation
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name
    _basic_input_validation(
        this_place,
        input_dataframe=df_stage_five,
        target_columns=average_weekly_questions_list,
    )

    # Validate required columns in input_dataframe
    required_columns = average_weekly_questions_list.copy()
    _required_column_validation(
        this_place, "df_stage_five", df_stage_five, required_columns
    )

    # Apply average weekly to average_weekly_questions_list, if any.

    def set_average_weekly(row):
        for base_col in average_weekly_questions_list:
            source_col = "date_adjusted_" + base_col
            new_col = "average_weekly_" + base_col
            row[new_col] = (7 * row[source_col]) / row[
                "number_of_days_in_actual_returned_period"
            ]
        return row

    df_stage_six = _run_apply(df_stage_five, set_average_weekly, da_error_flag_col)

    return df_stage_six</code></pre>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.date_adjustment">
<code class="highlight language-python">date_adjustment(input_dataframe, trading_weights, target_columns, contributor_returned_start_date_col, contributor_returned_end_date_col, expected_start_date_col, expected_end_date_col, domain_col, short_period_parameter_col, long_period_parameter_col, equal_weighted_col, set_to_mid_point_col, use_calendar_days_col, average_weekly_col, da_error_flag_col, trading_date_col, trading_weights_col, trading_domain_col, trading_period_start_col, trading_period_end_col, ignore_multi_aw_param_error=False)</code>

</h2>


  <div class="doc doc-contents ">
  
      <pre><code>**Description**:

The controlling function validates that validates input and steps the data through
the sub-functions in the following order:

1. generate_average_weekly_questions.
2. missing_value_subfunction.
3. primary_wrangler_subfunction.
4. midpoint_subfunction.
5. secondary_wrangler_subfunction.
6. date_adjustment_subfunction.
7. average_weekly_subfunction.

All calculations are done on a row by row basis. Full documentation can be found in
the README.md file in the docs directory.
</code></pre>
<hr />
<pre><code>**Parameters**

:param  input_dataframe: The dataframe containing the data to be processed plus processing options.
:param  trading_weights: The trading day weight reference data required for processing.
:param  target_columns: The names of the columns in input_dataframe to be date_adjusted.
:param  contributor_returned_start_date_col: Name of the column holding the contributors
returned period start date.
:param  contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
:param  expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
:param  expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
:param  domain_col: Name of the column holding the Domain in input_dataframe.
:param  short_period_parameter_col: Name of the column holding the "short period parameter" in input_dataframe.
:param  long_period_parameter_col: Name of the column holding the "long period parameter" in input_dataframe.
:param  set_to_mid_point_col: Name of the column holding the "Set to mid-point" option in input_dataframe.
:param  use_calendar_days_col: Name of the column holding the "use calendar days" option in input_dataframe.
:param  equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
:param  average_weekly_col: Name of the column holding the "average_weekly"
in input_dataframe.
:param  da_error_flag_col: Name of the column that the user wishes the error flag column to
be called in the output.
:param  trading_date_col: Name of the column holding the dates in trading_weights.
:param  trading_weights_col: Name of the column holding the weights in the
trading_weights DataFrame.
:param  trading_domain_col: Name of the column holding the domain in the
trading_weights DataFrame.
:param  trading_period_start_col: Name of the column holding the trading period start
date in the trading_weightsDataFrame.
:param  trading_period_end_col: Name of the column holding the trading period end date in the trading_weights
        DataFrame.
:param  ignore_multi_aw_param_error: Used in testing only. Leave blank so it defaults to False.

:raises TypeError: If the input dataframe is not a DataFrame.
:raises TypeError: If the trading weights reference data is not a DataFrame.
:raises TypeError: If the target columns parameter is not a List.
:raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe or the
        trading weights dataframe as appropriate.
:raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.
:raises ValueError: If mixed values found in the input dataframe for equal_weighted_col, set_to_mid_point_col or
        average_weekly_col.

:returns: The input data with the method output appended as extra columns as necessary
</code></pre>
<hr />
<pre><code>**Error Flags**

If a row of data is not able to be processed, an error flag will be raised to
indicate the issue with the data.
The error flags are as follows:
    * E00: Average Weekly parameter is invalid.
    * E01: The value to be date adjusted is missing from one of the target columns.
    * E02: The contributor returned end date is earlier than the contributor returned
            start date.
    * E03: A required record for calculating weight m is missing from the trading
            weights table.
    * E04: A required trading weight for calculating weight m is null or blank.
    * E05: A required trading weight for calculating weight m has a negative value.
    * E06: A required record for calculating weight n is missing from or duplicated in
            the trading  weights table.
    * E07: A required trading weight for calculating weight n is null or blank.
    * E08: A required trading weight for calculating weight n has a negative value.
    * E09: Contributors return does not cover any of expected period.
    * E10: The sum of trading day weights over contributors returned period is zero.
    * E11: The sum of trading day weights over contributors returned period is zero.
    * E12: A required record for calculating midpoint date is missing from the
            trading weights table.
    * E13: A required record for setting APS and APE by midpoint is missing from or
            duplicated in the trading  weights table.
    * E14: Expected period start date is missing or an invalid date.
    * E15: Expected period end date is missing or an invalid date.

    ** NOTE: **
    These are NOT exceptions and do not cause the method to fail. Once an error flag
    has been placed on a row of data, no further processing is done to that row,
    preserving the data in the state it was when the flag was raised.

    If at any point in processing an error flag is set on all rows, processing will
    stop after that sub-function and the dataframe will be returned as it is at that
    point to allow the user to 'debug' their data.
</code></pre>
<hr />
<pre><code>**Warning Flags**

If a row of data is able to be processed, but requires the user to be notified of a
potential issue, a warning flag is raised for that row. The following warning flags
are applied in the given circumstances:

        *  S: The contributors returned period is less than the threshold supplied
              in the short period parameter.
        *  L: The contributors returned period is greater than the threshold supplied
              in the long period parameter.
        * SL: The supplied short period parameter is greater than or equal to the
              supplied long period parameter.

    **NOTE:**
    A warning flag does not stop the method running, and the row will continue to be
    processed as normal.
</code></pre>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def date_adjustment(
    input_dataframe: pd.DataFrame,
    trading_weights: pd.DataFrame,
    target_columns: List,
    contributor_returned_start_date_col: str,
    contributor_returned_end_date_col: str,
    expected_start_date_col: str,
    expected_end_date_col: str,
    domain_col: str,
    short_period_parameter_col: str,
    long_period_parameter_col: str,
    equal_weighted_col: str,
    set_to_mid_point_col: str,
    use_calendar_days_col: str,
    average_weekly_col: str,
    da_error_flag_col: str,
    trading_date_col: str,
    trading_weights_col: str,
    trading_domain_col: str,
    trading_period_start_col: str,
    trading_period_end_col: str,
    ignore_multi_aw_param_error=False,
) -&gt; pd.DataFrame:
    """
        **Description**:

        The controlling function validates that validates input and steps the data through
        the sub-functions in the following order:

        1. generate_average_weekly_questions.
        2. missing_value_subfunction.
        3. primary_wrangler_subfunction.
        4. midpoint_subfunction.
        5. secondary_wrangler_subfunction.
        6. date_adjustment_subfunction.
        7. average_weekly_subfunction.

        All calculations are done on a row by row basis. Full documentation can be found in
        the README.md file in the docs directory.
    ----
        **Parameters**

        :param  input_dataframe: The dataframe containing the data to be processed plus processing options.
        :param  trading_weights: The trading day weight reference data required for processing.
        :param  target_columns: The names of the columns in input_dataframe to be date_adjusted.
        :param  contributor_returned_start_date_col: Name of the column holding the contributors
        returned period start date.
        :param  contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
        :param  expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
        :param  expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
        :param  domain_col: Name of the column holding the Domain in input_dataframe.
        :param  short_period_parameter_col: Name of the column holding the "short period parameter" in input_dataframe.
        :param  long_period_parameter_col: Name of the column holding the "long period parameter" in input_dataframe.
        :param  set_to_mid_point_col: Name of the column holding the "Set to mid-point" option in input_dataframe.
        :param  use_calendar_days_col: Name of the column holding the "use calendar days" option in input_dataframe.
        :param  equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
        :param  average_weekly_col: Name of the column holding the "average_weekly"
        in input_dataframe.
        :param  da_error_flag_col: Name of the column that the user wishes the error flag column to
        be called in the output.
        :param  trading_date_col: Name of the column holding the dates in trading_weights.
        :param  trading_weights_col: Name of the column holding the weights in the
        trading_weights DataFrame.
        :param  trading_domain_col: Name of the column holding the domain in the
        trading_weights DataFrame.
        :param  trading_period_start_col: Name of the column holding the trading period start
        date in the trading_weightsDataFrame.
        :param  trading_period_end_col: Name of the column holding the trading period end date in the trading_weights
                DataFrame.
        :param  ignore_multi_aw_param_error: Used in testing only. Leave blank so it defaults to False.

        :raises TypeError: If the input dataframe is not a DataFrame.
        :raises TypeError: If the trading weights reference data is not a DataFrame.
        :raises TypeError: If the target columns parameter is not a List.
        :raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe or the
                trading weights dataframe as appropriate.
        :raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.
        :raises ValueError: If mixed values found in the input dataframe for equal_weighted_col, set_to_mid_point_col or
                average_weekly_col.

        :returns: The input data with the method output appended as extra columns as necessary

    ----
        **Error Flags**

        If a row of data is not able to be processed, an error flag will be raised to
        indicate the issue with the data.
        The error flags are as follows:
            * E00: Average Weekly parameter is invalid.
            * E01: The value to be date adjusted is missing from one of the target columns.
            * E02: The contributor returned end date is earlier than the contributor returned
                    start date.
            * E03: A required record for calculating weight m is missing from the trading
                    weights table.
            * E04: A required trading weight for calculating weight m is null or blank.
            * E05: A required trading weight for calculating weight m has a negative value.
            * E06: A required record for calculating weight n is missing from or duplicated in
                    the trading  weights table.
            * E07: A required trading weight for calculating weight n is null or blank.
            * E08: A required trading weight for calculating weight n has a negative value.
            * E09: Contributors return does not cover any of expected period.
            * E10: The sum of trading day weights over contributors returned period is zero.
            * E11: The sum of trading day weights over contributors returned period is zero.
            * E12: A required record for calculating midpoint date is missing from the
                    trading weights table.
            * E13: A required record for setting APS and APE by midpoint is missing from or
                    duplicated in the trading  weights table.
            * E14: Expected period start date is missing or an invalid date.
            * E15: Expected period end date is missing or an invalid date.

            ** NOTE: **
            These are NOT exceptions and do not cause the method to fail. Once an error flag
            has been placed on a row of data, no further processing is done to that row,
            preserving the data in the state it was when the flag was raised.

            If at any point in processing an error flag is set on all rows, processing will
            stop after that sub-function and the dataframe will be returned as it is at that
            point to allow the user to 'debug' their data.

    ----
        **Warning Flags**

        If a row of data is able to be processed, but requires the user to be notified of a
        potential issue, a warning flag is raised for that row. The following warning flags
        are applied in the given circumstances:

                *  S: The contributors returned period is less than the threshold supplied
                      in the short period parameter.
                *  L: The contributors returned period is greater than the threshold supplied
                      in the long period parameter.
                * SL: The supplied short period parameter is greater than or equal to the
                      supplied long period parameter.

            **NOTE:**
            A warning flag does not stop the method running, and the row will continue to be
            processed as normal.

    """

    # Initialise dtypes for input columns
    dtype_dict = {
        contributor_returned_start_date_col: "datetime64[ns]",
        contributor_returned_end_date_col: "datetime64[ns]",
        expected_start_date_col: "datetime64[ns]",
        expected_end_date_col: "datetime64[ns]",
        "actual_period_start_date": "datetime64[ns]",
        "actual_period_end_date": "datetime64[ns]",
        equal_weighted_col: "object",
        domain_col: "object",
        set_to_mid_point_col: "object",
        use_calendar_days_col: "object",
        short_period_parameter_col: "int64",
        long_period_parameter_col: "int64",
        average_weekly_col: "object",
        da_error_flag_col: "object",
        trading_date_col: "datetime64[ns]",
        trading_weights_col: "object",
        trading_domain_col: "object",
        trading_period_start_col: "datetime64[ns]",
        trading_period_end_col: "datetime64[ns]",
        "domain_col_list": [domain_col, trading_domain_col],
    }

    # Basic validation
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name
    _basic_input_validation(
        this_place,
        input_dataframe=input_dataframe,
        trading_weights=trading_weights,
        target_columns=target_columns,
    )

    # Check df dtypes and change where necessary
    # noinspection PyTypeChecker
    input_dataframe = _set_dtypes(input_dataframe, dtype_dict, target_columns)

    # Validate required columns in input_dataframe
    required_columns = [
        contributor_returned_start_date_col,
        contributor_returned_end_date_col,
        contributor_returned_end_date_col,
        expected_start_date_col,
        expected_end_date_col,
        equal_weighted_col,
        domain_col,
        set_to_mid_point_col,
        use_calendar_days_col,
        short_period_parameter_col,
        long_period_parameter_col,
        average_weekly_col,
    ]
    for col_name in target_columns:
        required_columns.append(col_name)
    _required_column_validation(
        this_place, "input_dataframe", input_dataframe, required_columns
    )

    # Validate required columns are in trading_weights dataframe
    required_columns = [
        trading_weights_col,
        trading_date_col,
        trading_domain_col,
        trading_period_start_col,
        trading_period_end_col,
    ]
    _required_column_validation(
        this_place, "trading_weights", trading_weights, required_columns
    )

    # Ensure only one average_weekly_param value present
    check_list = list(input_dataframe[average_weekly_col].unique())
    if not ignore_multi_aw_param_error:
        if len(check_list) != 1:
            # Initiate fast fail with AW error flag in error flag column
            df_aw_param_error = input_dataframe
            df_aw_param_error[da_error_flag_col] = "E00"
            return df_aw_param_error

    # Ensure only one set_to_mid_point_col value present
    check_list = list(input_dataframe[set_to_mid_point_col].unique())
    if not ignore_multi_aw_param_error:
        if len(check_list) != 1:
            msg = (
                f"the use mid-point method parameter from {set_to_mid_point_col} "
                f"has more than one unique value set in the input dataframe."
            )
            raise ValueError(msg)

    # Ensure only one equal_weighted_col value present
    check_list = list(input_dataframe[equal_weighted_col].unique())
    if not ignore_multi_aw_param_error:
        if len(check_list) != 1:
            msg = (
                f"the use equal weights parameter from {equal_weighted_col} "
                f"has more than one unique value set in the input dataframe."
            )
            raise ValueError(msg)

    # Check cols for reserved names (ones that method adds later) to prevent overwrite.
    cols = list(input_dataframe.columns)
    reserved = [
        "midpoint",
        "actual_period_start_date",
        "actual_period_end_date",
        "date_change_in_return_period_flag",
        "number_of_days_in_contributors_returned_period"
        "sum_of_trading_day_weights_over_actual_returned_period",
        "sum_of_trading_day_weights_over_contributors_returned_period",
    ]
    for col in cols:
        if col in reserved:
            msg = (
                f"Reserved column name of {col} found in input dataframe column names."
            )
            raise ValueError(msg)

    # Initialise 'average_weekly_questions_list' to hold list of questions that will
    # use average weekly functionality
    average_weekly_param = input_dataframe.loc[0][average_weekly_col]
    average_weekly_questions_list = generate_average_weekly_questions(
        average_weekly_param, target_columns
    )
    # indirectly validate contents of average_weekly parameter
    if not isinstance(average_weekly_questions_list, list):
        # Initiate fast fail with AW error flag in error flag column
        df_aw_param_error = input_dataframe
        df_aw_param_error[da_error_flag_col] = "E00"
        return df_aw_param_error

    # Send dataframe through missing value subfunction
    df_stage_one = missing_value_subfunction(
        input_dataframe, target_columns, da_error_flag_col
    )

    # Check df_stage_one dtypes and change where necessary
    # noinspection PyTypeChecker
    df_stage_one = _set_dtypes(df_stage_one, dtype_dict, target_columns)

    # Check trading_weights dtypes and change where necessary
    trading_weights = _set_dtypes(trading_weights, dtype_dict)

    # If all rows error flagged, output dataframe as is.
    if df_stage_one[da_error_flag_col].notnull().values.all():
        return df_stage_one

    df_stage_two = primary_wrangler_subfunction(
        df_stage_one,
        trading_weights,
        target_columns,
        contributor_returned_start_date_col,
        contributor_returned_end_date_col,
        expected_start_date_col,
        expected_end_date_col,
        domain_col,
        equal_weighted_col,
        da_error_flag_col,
        trading_domain_col,
        trading_date_col,
        trading_weights_col,
    )

    # If all rows error flagged, output dataframe as is.
    if df_stage_two[da_error_flag_col].notnull().values.all():
        return df_stage_two

    # Send dataframe through midpoint method
    df_stage_three = midpoint_subfunction(
        df_stage_two,
        trading_weights,
        target_columns,
        domain_col,
        expected_start_date_col,
        expected_end_date_col,
        contributor_returned_start_date_col,
        contributor_returned_end_date_col,
        set_to_mid_point_col,
        equal_weighted_col,
        use_calendar_days_col,
        trading_date_col,
        trading_period_start_col,
        trading_period_end_col,
        trading_weights_col,
        trading_domain_col,
        da_error_flag_col,
    )

    # If all rows error flagged, output dataframe as is.
    if df_stage_three[da_error_flag_col].notnull().values.all():
        return df_stage_three

    # Send dataframe through secondary wrangler
    df_stage_four = secondary_wrangler_subfunction(
        df_stage_three,
        trading_weights,
        target_columns,
        contributor_returned_start_date_col,
        contributor_returned_end_date_col,
        expected_start_date_col,
        expected_end_date_col,
        domain_col,
        equal_weighted_col,
        set_to_mid_point_col,
        short_period_parameter_col,
        long_period_parameter_col,
        da_error_flag_col,
        trading_date_col,
        trading_domain_col,
        trading_weights_col,
    )

    # If all rows error flagged, output dataframe as is.
    if df_stage_four[da_error_flag_col].notnull().values.all():
        return df_stage_four

    # Send dataframe through date adjustment method.
    df_stage_five = date_adjustment_subfunction(
        df_stage_four, target_columns, da_error_flag_col
    )

    # If all rows error flagged, output dataframe as is.
    if df_stage_five[da_error_flag_col].notnull().values.all():
        return df_stage_five

    # Send dataframe through average weekly method.
    df_stage_six = average_weekly_subfunction(
        df_stage_five, average_weekly_questions_list, da_error_flag_col
    )

    output_dataframe = df_stage_six.copy()

    return output_dataframe</code></pre>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.date_adjustment_subfunction">
<code class="highlight language-python">date_adjustment_subfunction(df_stage_four, target_columns, da_error_flag_col)</code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Prepares the data for further processing by the date adjustment and average weekly methods as required.</p>
<p>:param df_stage_four: The dataframe containing the data as processed to this point.
:param target_columns: The names of the columns in the input dataframe to be date_adjusted.
:param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.</p>
<p>:raises TypeError: If the input dataframe is not a DataFrame; If the target columns parameter is not a List.
:raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe; If
        columns referenced in target_columns parameter cannot be found in the input dataframe.</p>
<p>:return: A dataframe holding data with the date adjustment method applied.</p>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def date_adjustment_subfunction(
    df_stage_four: pd.DataFrame, target_columns: List, da_error_flag_col: str
) -&gt; pd.DataFrame:
    """
    Prepares the data for further processing by the date adjustment and average weekly methods as required.

    :param df_stage_four: The dataframe containing the data as processed to this point.
    :param target_columns: The names of the columns in the input dataframe to be date_adjusted.
    :param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.

    :raises TypeError: If the input dataframe is not a DataFrame; If the target columns parameter is not a List.
    :raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe; If
            columns referenced in target_columns parameter cannot be found in the input dataframe.

    :return: A dataframe holding data with the date adjustment method applied.

    """

    # Basic validation
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name
    _basic_input_validation(
        this_place, input_dataframe=df_stage_four, target_columns=target_columns
    )

    # Validate required columns in input_dataframe
    required_columns = [
        "sum_of_trading_day_weights_over_contributors_returned_period",
        "sum_of_trading_day_weights_over_actual_returned_period",
    ]
    _required_column_validation(
        this_place, "df_stage_four", df_stage_four, required_columns
    )

    def da_method(row):

        # SPP83 - AC 3
        if row["sum_of_trading_day_weights_over_contributors_returned_period"] == 0:
            row = _apply_error_flag(row, "E10", da_error_flag_col, target_columns)
            return row

        # SPP83 - AC 2
        if row["sum_of_trading_day_weights_over_actual_returned_period"] == 0:
            row = _apply_error_flag(row, "E11", da_error_flag_col, target_columns)
            return row

        # SPP83 - AC 3
        for col in target_columns:
            da_col_name = "date_adjusted_" + col
            row[da_col_name] = row[col] * (
                row["sum_of_trading_day_weights_over_actual_returned_period"]
                / row["sum_of_trading_day_weights_over_contributors_returned_period"]
            )
        return row

    df_stage_five = _run_apply(df_stage_four, da_method, da_error_flag_col)

    return df_stage_five</code></pre>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.generate_average_weekly_questions">
<code class="highlight language-python">generate_average_weekly_questions(average_weekly, target_columns)</code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generates the reference list that controls the average_weekly method.</p>
<p>:param String average_weekly: The average weekly parameter for the run. (Not the column name, the actual value.)
:param List[Strings] target_columns: The names of the columns in input_dataframe to be date_adjusted.</p>
<p>:raises TypeError: If the data held in column referenced by the target_columns_col parameter is not a list.</p>
<p>:returns: A list of validated columns to run the average_weekly method against.</p>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def generate_average_weekly_questions(
    average_weekly: str, target_columns: List
) -&gt; Union[List, str]:
    """
    Generates the reference list that controls the average_weekly method.

    :param String average_weekly: The average weekly parameter for the run. (Not the column name, the actual value.)
    :param List[Strings] target_columns: The names of the columns in input_dataframe to be date_adjusted.

    :raises TypeError: If the data held in column referenced by the target_columns_col parameter is not a list.

    :returns: A list of validated columns to run the average_weekly method against.


    """
    # Validate target_columns is a list
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name
    if not isinstance(target_columns, list):
        msg = 'Param "target_columns" for function ' + this_place + " "
        msg += "should be of type List, not " + str(type(target_columns)) + "."
        raise TypeError(msg)

    if average_weekly == "N":
        average_weekly_questions_list = []
    elif average_weekly == "A":
        average_weekly_questions_list = target_columns.copy()
    else:
        average_weekly_questions_list = []
        submitted_questions = _convert_question_string_to_list(average_weekly)
        for column in target_columns:
            if column in submitted_questions:
                average_weekly_questions_list.append(column)
                submitted_questions = [x for x in submitted_questions if x != column]
        if submitted_questions:
            return "ERROR: invalid average_weekly parameter contents."

    return average_weekly_questions_list</code></pre>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.midpoint_subfunction">
<code class="highlight language-python">midpoint_subfunction(df_stage_two, trading_weights, target_columns, domain_col, expected_start_date_col, expected_end_date_col, contributor_returned_start_date_col, contributor_returned_end_date_col, set_to_mid_point_col, equal_weighted_col, use_calendar_days_col, trading_date_col, trading_period_start_col, trading_period_end_col, trading_weights_col, trading_domain_col, da_error_flag_col)</code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Applies the midpoint method to the input data.</p>
<p>:param  df_stage_two: The dataframe containing the data as processed to this point.
:param  trading_weights: The trading day weight reference data required for processing.
:param  target_columns: The names of the columns in the input dataframe to be date_adjusted.
:param  domain_col: Name of the column holding the Domain in input_dataframe.
:param  set_to_mid_point_col: Name of the column holding the set to midpoint parameter.
:param  use_calendar_days_col: Name of the column holding the "use calendar days" option in input_dataframe.
:param  equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
:param  contributor_returned_start_date_col: Name of the column holding the contributors returned period start date.
:param  contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
:param  expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
:param  expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
:param  da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.
:param  trading_date_col: Name of the column holding the dates in trading_weights.
:param  trading_weights_col: Name of the column holding the weights in the trading_weights DataFrame.
:param  trading_domain_col: Name of the column holding the domain in the trading_weights DataFrame.
:param  trading_period_start_col: Name of the column holding the trading period start date in the trading_weights
        DataFrame.
:param  trading_period_end_col: Name of the column holding the trading period end date in the trading_weights
        DataFrame.</p>
<p>:raises TypeError: If the input dataframe is not a DataFrame.
:raises TypeError: If the target columns parameter is not a List.
:raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe.
:raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.</p>
<p>:return: A dataframe holding data with the midpoint method applied.</p>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def midpoint_subfunction(
    df_stage_two: pd.DataFrame,
    trading_weights: pd.DataFrame,
    target_columns: List,
    domain_col: str,
    expected_start_date_col: str,
    expected_end_date_col: str,
    contributor_returned_start_date_col: str,
    contributor_returned_end_date_col: str,
    set_to_mid_point_col: str,
    equal_weighted_col: str,
    use_calendar_days_col: str,
    trading_date_col: str,
    trading_period_start_col: str,
    trading_period_end_col: str,
    trading_weights_col: str,
    trading_domain_col: str,
    da_error_flag_col: str,
) -&gt; pd.DataFrame:
    """
    Applies the midpoint method to the input data.

    :param  df_stage_two: The dataframe containing the data as processed to this point.
    :param  trading_weights: The trading day weight reference data required for processing.
    :param  target_columns: The names of the columns in the input dataframe to be date_adjusted.
    :param  domain_col: Name of the column holding the Domain in input_dataframe.
    :param  set_to_mid_point_col: Name of the column holding the set to midpoint parameter.
    :param  use_calendar_days_col: Name of the column holding the "use calendar days" option in input_dataframe.
    :param  equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
    :param  contributor_returned_start_date_col: Name of the column holding the contributors returned period start date.
    :param  contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
    :param  expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
    :param  expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
    :param  da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.
    :param  trading_date_col: Name of the column holding the dates in trading_weights.
    :param  trading_weights_col: Name of the column holding the weights in the trading_weights DataFrame.
    :param  trading_domain_col: Name of the column holding the domain in the trading_weights DataFrame.
    :param  trading_period_start_col: Name of the column holding the trading period start date in the trading_weights
            DataFrame.
    :param  trading_period_end_col: Name of the column holding the trading period end date in the trading_weights
            DataFrame.

    :raises TypeError: If the input dataframe is not a DataFrame.
    :raises TypeError: If the target columns parameter is not a List.
    :raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe.
    :raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.

    :return: A dataframe holding data with the midpoint method applied.

    """

    # Basic validation checks
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name
    _basic_input_validation(
        this_place, input_dataframe=df_stage_two, target_columns=target_columns
    )

    # Validate required columns are in df_stage_two dataframe
    required_columns = [
        domain_col,
        expected_start_date_col,
        expected_end_date_col,
        contributor_returned_start_date_col,
        contributor_returned_end_date_col,
        set_to_mid_point_col,
        equal_weighted_col,
        use_calendar_days_col,
        da_error_flag_col,
    ]
    _required_column_validation(
        this_place, "df_stage_two", df_stage_two, required_columns
    )

    working_dataframe = df_stage_two.copy()

    def mid_point_process(row):
        # Rule 3.3, flow chart 11,9: If midpoint not Y or YT, set defaults of APx = EPx.
        if row[set_to_mid_point_col] in ["Y", "YT"]:
            if row[equal_weighted_col] == "Y":  # Flowchart 7a
                row[set_to_mid_point_col] = "Y"
            else:  # Flowchart 7b
                # Set CRPS to earliest date &gt;= CRPS with non-zero weight in same domain.
                non_zero_after_crps = trading_weights[
                    (trading_weights[trading_weights_col] &gt; 0)
                    &amp; (
                        trading_weights[trading_date_col]
                        &gt;= row[contributor_returned_start_date_col]
                    )
                    &amp; (trading_weights[trading_domain_col] == row[domain_col])
                ].sort_values(by=trading_date_col, ascending=True)

                # set CRPS, error if reference df is empty.
                if len(non_zero_after_crps) &gt; 0:  # Flowchart 7c
                    min_date_index = non_zero_after_crps[trading_date_col].idxmin()
                    row[contributor_returned_start_date_col] = non_zero_after_crps.at[
                        min_date_index, trading_date_col
                    ]
                else:
                    row = _apply_error_flag(
                        row, "E12", da_error_flag_col, target_columns
                    )
                    return row

                # CRPE = latest period &lt;= CRPE with non-zero weight
                non_zero_before_crpe = trading_weights[
                    (trading_weights[trading_weights_col] &gt; 0)
                    &amp; (
                        trading_weights[trading_date_col]
                        &lt;= row[contributor_returned_end_date_col]
                    )
                    &amp; (trading_weights[trading_domain_col] == row[domain_col])
                ].sort_values(by=trading_date_col, ascending=True)

                # set CRPE, error if reference df is empty.
                if len(non_zero_before_crpe) &gt; 0:  # Not on flowchart, added in testing.
                    max_date_index = non_zero_before_crpe[trading_date_col].idxmax()
                    row[contributor_returned_end_date_col] = non_zero_before_crpe.at[
                        max_date_index, trading_date_col
                    ]
                else:
                    row = _apply_error_flag(
                        row, "E12", da_error_flag_col, target_columns
                    )
                    return row

            # Calculate midpoint  (Flowchart #8)
            date_diff = (
                row[contributor_returned_end_date_col]
                - row[contributor_returned_start_date_col]
            ).days + 1

            additional_days = int(
                (date_diff / 2) if date_diff % 2 == 0 else ((date_diff + 1) / 2)
            )

            # Subtracting 1 from additional days as methodology count the the start date
            # as day one. (ie they add 20 to 10 and get 29! :)
            midpoint_date = row[contributor_returned_start_date_col] + timedelta(
                days=(additional_days - 1)
            )

            row["midpoint_date"] = midpoint_date
            row["date_change_in_return_period_flag"] = ""

            # Use midpoint date value
            if not (
                row[expected_start_date_col]
                &lt;= midpoint_date
                &lt;= row[expected_end_date_col]
            ):
                # Flowchart #10a
                row["date_change_in_return_period_flag"] = "C"
                if row[use_calendar_days_col] == "Y":
                    # Flowchart #10b
                    first_day = 1
                    last_day = monthrange(midpoint_date.year, midpoint_date.month)[1]
                    row["actual_period_start_date"] = pd.Timestamp(
                        year=midpoint_date.year,
                        month=midpoint_date.month,
                        day=first_day,
                    )
                    row["actual_period_end_date"] = pd.Timestamp(
                        year=midpoint_date.year, month=midpoint_date.month, day=last_day
                    )
                else:
                    # Flowchart #10c
                    midpoint_data = trading_weights[
                        (trading_weights[trading_date_col] == midpoint_date)
                        &amp; (trading_weights[trading_domain_col] == row[domain_col])
                    ]
                    # Use midpoint date trading period dates.
                    if len(midpoint_data) == 1:  # Not on flowchart, added in testing.
                        row["actual_period_start_date"] = midpoint_data[
                            trading_period_start_col
                        ].values[0]
                        row["actual_period_end_date"] = midpoint_data[
                            trading_period_end_col
                        ].values[0]

                    # Error if it doesnt exist (or theres a duplicate row). This is
                    # normally picked up by E06 but in the case where a record had the
                    # wrong trading period date, there will be one missing, and one
                    # extra, which spoofs the tests for E06.
                    else:
                        row = _apply_error_flag(
                            row, "E13", da_error_flag_col, target_columns
                        )
                        return row
                return row  # From flowchart position 10b or 10c

        # Flowchart #9
        row["actual_period_start_date"] = row[expected_start_date_col]
        row["actual_period_end_date"] = row[expected_end_date_col]
        return row  # From flowchart position 9

    df_stage_three = _run_apply(working_dataframe, mid_point_process, da_error_flag_col)

    return df_stage_three</code></pre>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.missing_value_subfunction">
<code class="highlight language-python">missing_value_subfunction(input_dataframe, target_columns, da_error_flag_col)</code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Checks the target columns for missing data.</p>
<p>:param input_dataframe: The dataframe containing the data to be processed plus processing options.
:param target_columns: The names of the columns in input_dataframe to be date_adjusted.
:param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.</p>
<p>:raises TypeError: If the input dataframe is not a DataFrame.
:raises TypeError: If the target columns parameter is not a List.
:raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe.
:raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.</p>
<p>:returns: Data with rows that have missing data in the target columns marked with an error flag.</p>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def missing_value_subfunction(
    input_dataframe: pd.DataFrame, target_columns: List, da_error_flag_col: str
) -&gt; pd.DataFrame:
    """
    Checks the target columns for missing data.

    :param input_dataframe: The dataframe containing the data to be processed plus processing options.
    :param target_columns: The names of the columns in input_dataframe to be date_adjusted.
    :param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.

    :raises TypeError: If the input dataframe is not a DataFrame.
    :raises TypeError: If the target columns parameter is not a List.
    :raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe.
    :raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.

    :returns: Data with rows that have missing data in the target columns marked with an error flag.

    """
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name

    # noinspection PyProtectedMember
    _basic_input_validation(
        this_place, input_dataframe=input_dataframe, target_columns=target_columns
    )

    # Validate required columns in input_dataframe
    _required_column_validation(
        this_place, "input_dataframe", input_dataframe, target_columns
    )

    # Create working copy of input dataframe
    working_dataframe = input_dataframe.copy()

    # Add the error flag column for future use and output.
    working_dataframe[da_error_flag_col] = np.nan

    # Check and apply the error flag as appropriate
    def check_for_null(row):
        for target_column in target_columns:
            if pd.isnull(row[target_column]) or row[target_column] == ".":
                row[target_column] = np.nan
                row[da_error_flag_col] = "E01"
        return row

    df_stage_one = working_dataframe.apply(check_for_null, axis=1)

    return df_stage_one</code></pre>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.primary_wrangler_subfunction">
<code class="highlight language-python">primary_wrangler_subfunction(df_stage_one, trading_weights, target_columns, contributor_returned_start_date_col, contributor_returned_end_date_col, expected_start_date_col, expected_end_date_col, domain_col, equal_weighted_col, da_error_flag_col, trading_domain_col, trading_date_col, trading_weights_col)</code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Prepares the data for further processing by the midpoint method if required.</p>
<p>:param df_stage_one: The dataframe containing the data as processed to this point.
:param trading_weights: The trading day weight reference data required for processing.
:param target_columns: The names of the columns in the input dataframe to be date_adjusted.
:param contributor_returned_start_date_col: Name of the column holding the contributors returned period start date.
:param contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
:param expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
:param expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
:param domain_col: Name of the column holding the Domain in input_dataframe.
:param equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
:param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.
:param trading_date_col: Name of the column holding the dates in trading_weights.
:param trading_weights_col: Name of the column holding the weights in trading_weights.
:param trading_domain_col: Name of the column holding the domain in trading_weights.</p>
<p>:raises TypeError: If the input dataframe is not a DataFrame.
:raises TypeError: If the trading weights reference data is not a DataFrame.
:raises TypeError: If the target columns parameter is not a List.
:raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe or the
        trading weights dataframe as appropriate.
:raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.</p>
<p>:return: A dataframe holding data and structure ready to be passed into the midpoint method sub-function.</p>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def primary_wrangler_subfunction(
    df_stage_one: pd.DataFrame,
    trading_weights: pd.DataFrame,
    target_columns: List,
    contributor_returned_start_date_col: str,
    contributor_returned_end_date_col: str,
    expected_start_date_col: str,
    expected_end_date_col: str,
    domain_col: str,
    equal_weighted_col: str,
    da_error_flag_col: str,
    trading_domain_col: str,
    trading_date_col: str,
    trading_weights_col: str,
) -&gt; pd.DataFrame:
    """
    Prepares the data for further processing by the midpoint method if required.

    :param df_stage_one: The dataframe containing the data as processed to this point.
    :param trading_weights: The trading day weight reference data required for processing.
    :param target_columns: The names of the columns in the input dataframe to be date_adjusted.
    :param contributor_returned_start_date_col: Name of the column holding the contributors returned period start date.
    :param contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
    :param expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
    :param expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
    :param domain_col: Name of the column holding the Domain in input_dataframe.
    :param equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
    :param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.
    :param trading_date_col: Name of the column holding the dates in trading_weights.
    :param trading_weights_col: Name of the column holding the weights in trading_weights.
    :param trading_domain_col: Name of the column holding the domain in trading_weights.

    :raises TypeError: If the input dataframe is not a DataFrame.
    :raises TypeError: If the trading weights reference data is not a DataFrame.
    :raises TypeError: If the target columns parameter is not a List.
    :raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe or the
            trading weights dataframe as appropriate.
    :raises KeyError: If columns referenced in target_columns parameter cannot be found in the input dataframe.

    :return: A dataframe holding data and structure ready to be passed into the midpoint method sub-function.

    """
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name

    # Basic validation checks
    # noinspection PyProtectedMember
    _basic_input_validation(
        this_place,
        input_dataframe=df_stage_one,
        trading_weights=trading_weights,
        target_columns=target_columns,
    )

    # Validate required columns are in input dataframe
    required_columns = [
        contributor_returned_start_date_col,
        contributor_returned_end_date_col,
        da_error_flag_col,
        equal_weighted_col,
        expected_start_date_col,
        expected_end_date_col,
    ]
    for col_name in target_columns:
        required_columns.append(col_name)
    _required_column_validation(
        this_place, "df_stage_one", df_stage_one, required_columns
    )

    # Validate required columns are in trading_weights dataframe
    required_columns = [trading_weights_col, trading_date_col, trading_domain_col]
    _required_column_validation(
        this_place, "trading_weights", trading_weights, required_columns
    )

    working_dataframe = df_stage_one.copy()

    # Rule 3.1 &amp; 3.2

    def fix_dates(row):

        #  Ensure we have the EPS and EPE dates and they are valid.
        if pd.isnull(row[expected_start_date_col]):
            row = _apply_error_flag(row, "E14", da_error_flag_col, target_columns)
            return row
        if pd.isnull(row[expected_end_date_col]):
            row = _apply_error_flag(row, "E15", da_error_flag_col, target_columns)
            return row

        # Fix NaT start date
        if pd.isna(row[contributor_returned_start_date_col]):
            row[contributor_returned_start_date_col] = row[expected_start_date_col]
            row[contributor_returned_start_date_col] = pd.to_datetime(
                row[contributor_returned_start_date_col],
                format="%Y%m%d",
                errors="coerce",
            )

        # Fix NaT end date
        if pd.isna(row[contributor_returned_end_date_col]):
            row[contributor_returned_end_date_col] = row[expected_end_date_col]
            row[contributor_returned_end_date_col] = pd.to_datetime(
                row[contributor_returned_end_date_col], format="%Y%m%d", errors="coerce"
            )

        return row

    working_dataframe = _run_apply(working_dataframe, fix_dates, da_error_flag_col)

    # Rule 3.3, 3.4, 3.5, 3.6, 3.7

    def preliminary_stages(row):
        # Set defaults
        row["sum_of_trading_day_weights_over_contributors_returned_period"] = 0
        row["number_of_days_in_contributors_returned_period"] = 0

        # Calculate actual or flags.
        if (
            row[contributor_returned_end_date_col]
            &lt; row[contributor_returned_start_date_col]
        ):
            row = _apply_error_flag(row, "E02", da_error_flag_col, target_columns)
            return row
        else:
            row["number_of_days_in_contributors_returned_period"] = (
                row[contributor_returned_end_date_col]
                - row[contributor_returned_start_date_col]
            ).days + 1

            if row[equal_weighted_col] == "Y":
                row[
                    "sum_of_trading_day_weights_over_contributors_returned_period"
                ] = row["number_of_days_in_contributors_returned_period"]

            else:
                flagged = 0
                error_code_number = 0
                mask = (
                    (
                        trading_weights[trading_date_col]
                        &gt;= row[contributor_returned_start_date_col]
                    )
                    &amp; (
                        trading_weights[trading_date_col]
                        &lt;= row[contributor_returned_end_date_col]
                    )
                    &amp; (trading_weights[trading_domain_col] == row[domain_col])
                )

                filtered_weights = trading_weights.loc[mask]

                if (
                    len(filtered_weights.index)
                    != row["number_of_days_in_contributors_returned_period"]
                ):
                    flagged = 1
                    error_code_number = 3
                else:
                    for _idx, record in filtered_weights.iterrows():
                        if isinstance(record[trading_weights_col], str):
                            if not record[trading_weights_col].strip():
                                flagged = 1
                                error_code_number = 4
                            else:
                                if float(record[trading_weights_col]) &lt; 0:
                                    flagged = 1
                                    error_code_number = 5
                        else:
                            if pd.isnull(record[trading_weights_col]):
                                flagged = 1
                                error_code_number = 4
                            if record[trading_weights_col] &lt; 0:
                                flagged = 1
                                error_code_number = 5
                if flagged:
                    row = _apply_error_flag(
                        row,
                        "E0" + str(error_code_number),
                        da_error_flag_col,
                        target_columns,
                    )
                else:
                    row[
                        "sum_of_trading_day_weights_over_contributors_returned_period"
                    ] = filtered_weights[trading_weights_col].sum()
            return row

    df_stage_two = _run_apply(working_dataframe, preliminary_stages, da_error_flag_col)

    return df_stage_two</code></pre>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="sml_small.date_adjustment.secondary_wrangler_subfunction">
<code class="highlight language-python">secondary_wrangler_subfunction(df_stage_three, trading_weights, target_columns, contributor_returned_start_date_col, contributor_returned_end_date_col, expected_start_date_col, expected_end_date_col, domain_col, equal_weighted_col, set_to_mid_point_col, short_period_parameter_col, long_period_parameter_col, da_error_flag_col, trading_date_col, trading_domain_col, trading_weights_col)</code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Prepares the data for further processing by the date adjustment and average weekly methods as required.</p>
<p>:param df_stage_three: The dataframe containing the data as processed to this point.
:param trading_weights: The trading day weight reference data required for processing.
:param target_columns: The names of the columns in the input dataframe to be date_adjusted.
:param contributor_returned_start_date_col: Name of the column holding the contributors returned period start date.
:param contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
:param expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
:param expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
:param domain_col: Name of the column holding the Domain in input_dataframe.
:param equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
:param short_period_parameter_col: Name of the column holding the "short period parameter" in input_dataframe.
:param long_period_parameter_col: Name of the column holding the "long period parameter" in input_dataframe.
:param set_to_mid_point_col: Name of the column holding the "Set to mid-point" option in input_dataframe.
:param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.
:param trading_date_col: Name of the column holding the dates in trading_weights.
:param trading_weights_col: Name of the column holding the weights in trading_weights.
:param trading_domain_col: Name of the column holding the domain in trading_weights.</p>
<p>:raises TypeError: If the input dataframe is not a DataFrame; If the trading weights reference data is not a
        DataFrame; If the target columns parameter is not a List.
:raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe or the
        trading weights dataframe as appropriate; If columns referenced in target_columns parameter cannot be
        found in the input dataframe.</p>
<p>:return: A dataframe holding data and structure ready to be passed into the midpoint method sub-function.</p>

      <details class="quote">
        <summary>Source code in <code>sml_small/date_adjustment.py</code></summary>
        <pre class="highlight"><code class="language-python">def secondary_wrangler_subfunction(
    df_stage_three: pd.DataFrame,
    trading_weights: pd.DataFrame,
    target_columns: List,
    contributor_returned_start_date_col: str,
    contributor_returned_end_date_col: str,
    expected_start_date_col: str,
    expected_end_date_col: str,
    domain_col: str,
    equal_weighted_col: str,
    set_to_mid_point_col: str,
    short_period_parameter_col: str,
    long_period_parameter_col: str,
    da_error_flag_col: str,
    trading_date_col: str,
    trading_domain_col: str,
    trading_weights_col: str,
) -&gt; pd.DataFrame:
    """
    Prepares the data for further processing by the date adjustment and average weekly methods as required.

    :param df_stage_three: The dataframe containing the data as processed to this point.
    :param trading_weights: The trading day weight reference data required for processing.
    :param target_columns: The names of the columns in the input dataframe to be date_adjusted.
    :param contributor_returned_start_date_col: Name of the column holding the contributors returned period start date.
    :param contributor_returned_end_date_col: Name of the column holding the contributors returned period end date.
    :param expected_start_date_col: Name of the column holding the expected period start date in input_dataframe.
    :param expected_end_date_col: Name of the column holding the expected period end date in input_dataframe.
    :param domain_col: Name of the column holding the Domain in input_dataframe.
    :param equal_weighted_col: Name of the column holding the "Set to equal weighted" option in input_dataframe.
    :param short_period_parameter_col: Name of the column holding the "short period parameter" in input_dataframe.
    :param long_period_parameter_col: Name of the column holding the "long period parameter" in input_dataframe.
    :param set_to_mid_point_col: Name of the column holding the "Set to mid-point" option in input_dataframe.
    :param da_error_flag_col: Name of the column that the user wishes the error flag column to be called in the output.
    :param trading_date_col: Name of the column holding the dates in trading_weights.
    :param trading_weights_col: Name of the column holding the weights in trading_weights.
    :param trading_domain_col: Name of the column holding the domain in trading_weights.

    :raises TypeError: If the input dataframe is not a DataFrame; If the trading weights reference data is not a
            DataFrame; If the target columns parameter is not a List.
    :raises KeyError: If required columns referenced in the parameters cannot be found in the input dataframe or the
            trading weights dataframe as appropriate; If columns referenced in target_columns parameter cannot be
            found in the input dataframe.

    :return: A dataframe holding data and structure ready to be passed into the midpoint method sub-function.

    """
    # Basic validation
    # noinspection PyProtectedMember,PyUnresolvedReferences
    this_place = sys._getframe().f_code.co_name
    _basic_input_validation(
        this_place,
        input_dataframe=df_stage_three,
        trading_weights=trading_weights,
        target_columns=target_columns,
    )

    # Validate required columns in input_dataframe
    required_columns = [
        contributor_returned_start_date_col,
        contributor_returned_end_date_col,
        expected_start_date_col,
        expected_end_date_col,
        set_to_mid_point_col,
        short_period_parameter_col,
        long_period_parameter_col,
        da_error_flag_col,
        domain_col,
    ]
    _required_column_validation(
        this_place, "df_stage_three", df_stage_three, required_columns
    )

    # Validate required columns are in trading_weights dataframe
    required_columns = [trading_weights_col, trading_date_col, trading_domain_col]
    _required_column_validation(
        this_place, "trading_weights", trading_weights, required_columns
    )

    working_df_1 = df_stage_three.copy()

    # Rule 3.3, flow chart 12a: If midpoint not YT, set N to APE - APN,
    #   else 12b: set N to trimmed APE - APN.
    def mid_point_not_equal_yt(row):
        if row[set_to_mid_point_col] != "YT":
            row["number_of_days_in_actual_returned_period"] = (
                row["actual_period_end_date"] - (row["actual_period_start_date"])
            ).days + 1
        else:
            # Set APS to earliest date &gt;= APS with non-zero weight in same domain.
            non_zero_after_aps = trading_weights[
                (trading_weights[trading_weights_col] &gt; 0)
                &amp; (trading_weights[trading_date_col] &gt;= row["actual_period_start_date"])
                &amp; (trading_weights[trading_domain_col] == row[domain_col])
            ].sort_values(by=trading_date_col, ascending=True)

            # set APS as weights will always exist due to earlier checks.
            min_date_index = non_zero_after_aps[trading_date_col].idxmin()
            aps = non_zero_after_aps.at[min_date_index, trading_date_col]

            # APE = latest period &lt;= APE with non-zero weight
            non_zero_before_ape = trading_weights[
                (trading_weights[trading_weights_col] &gt; 0)
                &amp; (trading_weights[trading_date_col] &lt;= row["actual_period_end_date"])
                &amp; (trading_weights[trading_domain_col] == row[domain_col])
            ].sort_values(by=trading_date_col, ascending=True)

            # set APE as weights will always exist due to earlier checks.
            max_date_index = non_zero_before_ape[trading_date_col].idxmax()
            ape = non_zero_before_ape.at[max_date_index, trading_date_col]

            # Set N using trimmed APS and APE.
            row["number_of_days_in_actual_returned_period"] = (ape - aps).days + 1

        return row

    working_dataframe_2 = _run_apply(
        working_df_1, mid_point_not_equal_yt, da_error_flag_col
    )

    # Rule 5.4,5.5, flow chart 19:
    def short_and_long_parameter_validation(row):
        # 5.4 If less than short period parameter, mark length flag as 'S'
        if row["number_of_days_in_contributors_returned_period"] &lt; int(
            row[short_period_parameter_col]
        ):
            row["date_adjustment_length_flag"] = "S"
        # 5.5 If greater than Long period parameter, mark length flag as 'L'
        if row["number_of_days_in_contributors_returned_period"] &gt; int(
            row[long_period_parameter_col]
        ):
            row["date_adjustment_length_flag"] = "L"
        # 5.4,5.5 If params wrong way round, output 'SL' to flag.
        if int(row[short_period_parameter_col]) &gt;= int(row[long_period_parameter_col]):
            row["date_adjustment_length_flag"] = "SL"
        return row

    working_dataframe_3 = _run_apply(
        working_dataframe_2, short_and_long_parameter_validation, da_error_flag_col
    )

    def create_weights_n(row):

        if row[equal_weighted_col] == "Y":
            row["sum_of_trading_day_weights_over_actual_returned_period"] = row[
                "number_of_days_in_actual_returned_period"
            ]
        else:
            flagged = 0
            error_code_number = 0
            mask = (
                (trading_weights[trading_date_col] &gt;= row["actual_period_start_date"])
                &amp; (trading_weights[trading_date_col] &lt;= row["actual_period_end_date"])
                &amp; (trading_weights[trading_domain_col] == row[domain_col])
            )
            filtered_weights = trading_weights.loc[mask]

            if (
                len(filtered_weights.index)
                != row["number_of_days_in_actual_returned_period"]
            ):
                flagged = 1
                error_code_number = 6
            else:
                for _idx, record in filtered_weights.iterrows():
                    if isinstance(record[trading_weights_col], str):
                        if not record[trading_weights_col].strip():
                            flagged = 1
                            error_code_number = 7
                        else:
                            if float(record[trading_weights_col]) &lt; 0:
                                flagged = 1
                                error_code_number = 8
                    else:
                        if pd.isnull(record[trading_weights_col]):
                            flagged = 1
                            error_code_number = 7
                        if record[trading_weights_col] &lt; 0:
                            flagged = 1
                            error_code_number = 8
            if flagged:
                row["sum_of_trading_day_weights_over_actual_returned_period"] = 0
                row = _apply_error_flag(
                    row,
                    "E0" + str(error_code_number),
                    da_error_flag_col,
                    target_columns,
                )

            else:
                row[
                    "sum_of_trading_day_weights_over_actual_returned_period"
                ] = filtered_weights[trading_weights_col].sum()
        return row

    working_dataframe_4 = _run_apply(
        working_dataframe_3, create_weights_n, da_error_flag_col
    )

    def span_overlap_less_than_one_day(row):
        latest_start = max(
            row[expected_start_date_col], row[contributor_returned_start_date_col]
        )
        earliest_end = min(
            row[expected_end_date_col], row[contributor_returned_end_date_col]
        )
        delta = (earliest_end - latest_start).days + 1
        span = max(0, delta)

        if row[set_to_mid_point_col] == "N":
            if span &lt; 1:
                row = _apply_error_flag(row, "E09", da_error_flag_col, target_columns)
        return row

    df_stage_four = _run_apply(
        working_dataframe_4, span_overlap_less_than_one_day, da_error_flag_col
    )

    return df_stage_four</code></pre>
      </details>
  </div>

</div>



  </div>

  </div>

</div></p>
    </article>
</section>
        
            <!--

-->

<li >
    <a href="..">Home</a>
</li>

          
            <!--

-->

<li >
    <a href="../content/">Content</a>
</li>

          
                                    </main>
                                </div>
                            </div>
                        </div>
                    

                    
                </div>
                
                
                    
                        

    
    

    
        
    

    

    <footer class="ons-footer">

        

        

        <div class="ons-footer__body ons-page__footer" data-analytics="footer" >
            <div class="ons-container">
                <div class="ons-grid">
                    

                    

                    
                </div>

                <div class="ons-grid ons-grid--flex ons-grid--vertical-top ons-grid--between">
                    <div class="ons-grid__col">
                        

                        
                            <!-- OGL -->
                            <div class="ons-footer__license ons-u-mb-m">
                                

    

    
    
        <svg class="ons-footer__ogl-img" xmlns="http://www.w3.org/2000/svg" width="50px" height="20px" viewBox="0 0 60 24" focusable="false" aria-hidden="true">
            <title>Open Government License logo</title>
            <path d="M51.7,17.5V0l-6.2,4v19.8h13.8v-6.2H51.7z M36.7,16.3c-1,0.9-2.4,1.4-3.8,1.4c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8c2,0,3.9,1.1,4.9,2.7L43,5.6C40.9,2.2,37.1,0,32.9,0c-4.5,0-8.4,2.5-10.4,6.1C20.4,2.5,16.5,0,12,0C5.4,0,0,5.4,0,12s5.4,12,12,12c4.5,0,8.4-2.5,10.4-6.1c2.1,3.6,6,6.1,10.4,6.1c3,0,5.8-1.1,7.9-3l2.4,2.7h0.4V13h-9.8L36.7,16.3zM12,17.8c-3.2,0-5.8-2.6-5.8-5.8S8.8,6.2,12,6.2s5.8,2.6,5.8,5.8S15.2,17.8,12,17.8" fill="#595959"></path>
        </svg>
    
    

                                
                                    
                                    
                                        All content is available under the 
    <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" class="ons-external-link" target="_blank" rel="noopener">
        <span class="ons-external-link__text">Open Government Licence v3.0</span><span class="ons-external-link__icon">&nbsp;<svg class="ons-svg-icon" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true">
        <path d="M13.5,9H13a.5.5,0,0,0-.5.5v3h-9v-9h3A.5.5,0,0,0,7,3V2.5A.5.5,0,0,0,6.5,2h-4a.5.5,0,0,0-.5.5v11a.5.5,0,0,0,.5.5h11a.5.5,0,0,0,.5-.5v-4A.5.5,0,0,0,13.5,9Z" transform="translate(-2 -1.99)"/>
        <path d="M8.83,7.88a.51.51,0,0,0,.71,0l2.31-2.32,1.28,1.28A.51.51,0,0,0,14,6.49v-4a.52.52,0,0,0-.5-.5h-4A.51.51,0,0,0,9,2.52a.58.58,0,0,0,.14.33l1.28,1.28L8.12,6.46a.51.51,0,0,0,0,.71Z" transform="translate(-2 -1.99)"/>
    </svg></span><span class="ons-external-link__new-window-description ons-u-vh"> (opens in a new tab)</span></a>
, except where otherwise stated
                                    
                                
                            </div>
                        
                        
                            <div class="ons-footer__poweredby ons-u-mb-m">
                                
        
            

    

    
    
        <svg class="ons-svg-logo" xmlns="http://www.w3.org/2000/svg" width="197" height="19" viewBox="33 2 552 60" aria-labelledby="ons-logo-en-footer-alt">
            <title id="ons-logo-en-footer-alt">Office for National Statistics</title>
            <g class="ons-svg-logo__group ons-svg-logo__group--secondary" fill="#a8bd3a">
                <path d="M0,34.6c.8-1.69,1.39-3,2.32-4.6A38.28,38.28,0,0,1,0,23.4V34.6M5,3S0,3,0,9.25v1A62.12,62.12,0,0,0,4.2,27a43.77,43.77,0,0,1,9.42-10.79C21.69,9.21,31.16,5.13,45.9,3Z"/>
            </g>
            <g class="ons-svg-logo__group ons-svg-logo__group--primary" fill="#003c57">
                <path d="M53.06,6.42C36.2,8,24.68,12.92,16.43,20.07A41.46,41.46,0,0,0,6.4,32.2C12.87,44.93,28.88,57,46.6,57H47s6.32.21,6.32-6.91V6.36a1.22,1.22,0,0,1-.26.06M9.72,42.67a44.25,44.25,0,0,1-5-7.42A80.59,80.59,0,0,0,0,46.38V56.91L31.06,57c-9.83-3-15.74-7.64-21.34-14.3"/>
            </g>
            <g class="ons-svg-logo__group ons-svg-logo__group--text" fill="#003c57">
                <path d="M82,47.49c-9.07,0-13.13-7.51-13.13-16.77S72.91,14,82,14s13.1,7.61,13.1,16.77S91.1,47.54,82,47.54m0-30.91c-6.69,0-9.07,7.33-9.07,14.05s2.16,13.9,9.07,13.9,9-7.28,9-13.9-2.34-14-9-14"/>
                <path d="M106.36,23.81V46.88h-3.67V23.81H98.93V21.56h3.76V17.9c0-4.61,2.72-7.95,8.08-7.95.38,0,.86.05.86.05v2.35h-.43c-2.55,0-4.84,1.64-4.84,5.12v4.09h5.27v2.25Z"/>
                <path d="M121.53,23.81V46.88h-3.67V23.81H114.1V21.56h3.76V17.9c0-4.61,2.72-7.95,8.08-7.95.38,0,.86.05.86.05v2.35h-.43c-2.55,0-4.84,1.64-4.84,5.12v4.09h5.27v2.25Z"/>
                <path d="M132.85,16.72a2.28,2.28,0,0,1-2.33-2.23v0a2.34,2.34,0,0,1,4.67,0,2.28,2.28,0,0,1-2.3,2.26h0M131,21.56h3.71V46.88H131Z"/>
                <path d="M150.53,47.49c-6,0-10.63-5.16-10.63-13.29S144.52,21,150.66,21a9.76,9.76,0,0,1,6.17,1.74l-1,2.25a7.53,7.53,0,0,0-4.4-1.36c-5.15,0-7.78,4.46-7.78,10.48,0,6.2,3,10.62,7.65,10.62a8,8,0,0,0,4.49-1.37l1,2.45a10.21,10.21,0,0,1-6.3,1.73"/>
                <path d="M162.84,35.75c.48,6,3.76,9,8.9,9a14.66,14.66,0,0,0,6.88-1.55l1.08,2.59a18,18,0,0,1-8.22,1.73c-7.12,0-12.18-4.23-12.18-13.34,0-8.69,4.67-13.2,11-13.2s10.37,3.95,10.37,12.4Zm7.35-12.41c-4.1,0-7.56,3.2-7.52,10.29l14.39-2c0-5.87-2.81-8.32-6.87-8.32"/>
                <path d="M198.57,23.81V46.88H194.9V23.81h-3.76V21.56h3.76V17.9c0-4.61,2.72-7.95,8.08-7.95.39,0,.87.05.87.05v2.35h-.44c-2.54,0-4.84,1.64-4.84,5.12v4.09h5.28v2.25Z"/>
                <path d="M217.28,47.49c-7.47,0-10.89-5.78-10.89-13.24S209.81,21,217.28,21s10.85,5.82,10.85,13.3-3.37,13.24-10.85,13.24m0-24c-5.53,0-7.13,5.59-7.13,10.81s1.73,10.56,7.13,10.56,7.13-5.35,7.13-10.56-1.6-10.81-7.13-10.81"/>
                <path d="M244.08,23.91c-2.34-.61-5.75-.52-7.35.47v22.5H233V22.69c2.67-1.13,5.36-1.74,10.11-1.74H245Z"/>
                <path d="M277.42,47.13,263.07,25a32.2,32.2,0,0,1-1.85-3.29h-.09s.13,1.88.13,3.85V47.13h-4.71V14.8h5.31l13.61,20.82A28.76,28.76,0,0,1,277.38,39h.08s-.17-1.84-.17-3.77V14.8H282V47.13Z"/>
                <path d="M297.52,47.79c-7.43,0-10.93-3-10.93-7.81,0-6.8,7.12-8.64,15.59-9.39V29.13c0-3.47-2.37-4.51-5.83-4.51a18,18,0,0,0-6.87,1.46L288.23,23a24,24,0,0,1,9.12-1.83c5.61,0,9.93,2.3,9.93,8.78V46a22.71,22.71,0,0,1-9.76,1.83m4.66-14.67c-6.26.67-10.45,1.84-10.45,6.73,0,3.42,2.42,4.88,6.22,4.88a10.09,10.09,0,0,0,4.23-.84Z"/>
                <path d="M322,47.69c-5.31,0-7.34-3.43-7.34-6.86V25.09h-3.55V21.81h3.55V16.12l5.4-1.5v7.19H325v3.28h-5V40.55a3.26,3.26,0,0,0,3,3.52h.5a5.5,5.5,0,0,0,1.46-.23v3.33a7.69,7.69,0,0,1-3,.52"/>
                <path d="M331.91,17.43a3,3,0,0,1-3.15-2.81,3.17,3.17,0,0,1,6.31,0,3,3,0,0,1-3.16,2.81m-2.72,4.38h5.44V47.13h-5.44Z"/>
                <path d="M350.88,47.79c-7.73,0-11.57-5.74-11.57-13.3s3.84-13.34,11.57-13.34,11.54,5.78,11.54,13.34-3.8,13.3-11.54,13.3m0-23.17c-4.66,0-6.05,4.89-6.05,9.82s1.47,9.63,6.05,9.63,6.05-4.7,6.05-9.63-1.38-9.82-6.05-9.82"/>
                <path d="M382.52,47.13V29c0-3.24-2.77-4.47-5.88-4.47a12.3,12.3,0,0,0-4.37.76v21.8h-5.39V23a26.81,26.81,0,0,1,10.06-1.83c6.61,0,11,2.25,11,7.8V47.13Z"/>
                <path d="M403.18,47.79c-7.43,0-10.94-3-10.94-7.81,0-6.8,7.13-8.64,15.6-9.39V29.13c0-3.47-2.37-4.51-5.83-4.51a18,18,0,0,0-6.87,1.46L393.89,23A24,24,0,0,1,403,21.15c5.62,0,9.94,2.3,9.94,8.78V46a22.71,22.71,0,0,1-9.76,1.83m4.66-14.67c-6.27.67-10.46,1.84-10.46,6.73,0,3.42,2.43,4.88,6.23,4.88a10.09,10.09,0,0,0,4.23-.84Z"/>
                <polygon points="418.52 47.13 418.52 34.91 418.52 10.25 423.92 10.25 423.92 22.76 423.92 47.13 418.52 47.13"/>
                <path d="M445.39,47.79A19.11,19.11,0,0,1,436.58,46l1.51-4a13.48,13.48,0,0,0,6.22,1.55c3.76,0,6.44-2.21,6.44-5.41,0-7.09-13.44-4.36-13.44-14.42,0-5.13,4.15-9.59,10.72-9.59A15.82,15.82,0,0,1,455.8,16l-1.38,3.52a11.93,11.93,0,0,0-5.66-1.5c-3.5,0-5.79,2.11-5.79,5.12,0,7,13.74,3.94,13.74,14.65,0,5.74-4.71,10-11.32,10"/>
                <path d="M470.41,47.69c-5.31,0-7.34-3.43-7.34-6.86V25.09h-3.54V21.81h3.54V16.12l5.4-1.5v7.19h4.92v3.28h-4.92V40.55a3.27,3.27,0,0,0,3,3.52h.48a5.12,5.12,0,0,0,1.46-.23v3.33a7.69,7.69,0,0,1-3,.52"/>
                <path d="M487.27,47.79c-7.44,0-10.93-3-10.93-7.81,0-6.8,7.13-8.64,15.6-9.39V29.13c0-3.47-2.38-4.51-5.84-4.51a18,18,0,0,0-6.87,1.46L478,23a23.94,23.94,0,0,1,9.11-1.83c5.62,0,9.94,2.3,9.94,8.78V46a22.71,22.71,0,0,1-9.76,1.83M492,33.16c-6.27.67-10.46,1.84-10.46,6.73,0,3.42,2.42,4.88,6.22,4.88a10,10,0,0,0,4.24-.84Z"/>
                <path d="M511.73,47.69c-5.32,0-7.35-3.43-7.35-6.86V25.09h-3.54V21.81h3.54V16.12l5.4-1.5v7.19h4.92v3.28h-4.92V40.55a3.26,3.26,0,0,0,3,3.52h.5a5.5,5.5,0,0,0,1.46-.23v3.33a7.69,7.69,0,0,1-3,.52"/>
                <path d="M521.66,17.43a3,3,0,0,1-3.15-2.81,3.17,3.17,0,0,1,6.31,0,3,3,0,0,1-3.16,2.81m-2.72,4.38h5.45V47.13h-5.45Z"/>
                <path d="M536.19,47.79A15.9,15.9,0,0,1,528.54,46L530,42.48a10.53,10.53,0,0,0,5.52,1.5c2.77,0,5-1.78,5-3.94,0-6-11.1-3.2-11.1-11.47,0-3.76,3.37-7.42,8.86-7.42A13.56,13.56,0,0,1,545.34,23l-1.42,3.14a8.47,8.47,0,0,0-4.62-1.45c-2.81,0-4.54,1.69-4.54,3.62,0,5.64,11.32,3.14,11.32,11.6,0,4-3.85,7.9-9.89,7.9"/>
                <path d="M559.83,47.69c-5.31,0-7.35-3.43-7.35-6.86V25.09h-3.54V21.81h3.54V16.12l5.4-1.5v7.19h4.93v3.28h-4.93V40.55a3.27,3.27,0,0,0,3,3.52h.48a5.64,5.64,0,0,0,1.47-.23v3.33a7.72,7.72,0,0,1-3,.52"/>
                <path d="M569.77,17.43a3,3,0,0,1-3.15-2.81,3.17,3.17,0,0,1,6.31,0,3,3,0,0,1-3.16,2.81m-2.72,4.38h5.44V47.13h-5.44Z"/>
                <path d="M588.14,47.79c-6.23,0-11-5.08-11-13.35s4.88-13.29,11-13.29A10.51,10.51,0,0,1,594.66,23l-1.21,3a6.87,6.87,0,0,0-4-1.22c-4.4,0-6.69,3.81-6.69,9.49s2.63,9.59,6.61,9.59a6.74,6.74,0,0,0,4-1.28L594.7,46c-1.12.94-3.33,1.84-6.56,1.84"/>
                <path d="M605.1,47.79A15.9,15.9,0,0,1,597.45,46l1.42-3.47A10.54,10.54,0,0,0,604.4,44c2.77,0,5-1.78,5-3.94,0-6-11.1-3.2-11.1-11.47,0-3.76,3.37-7.42,8.85-7.42a13.49,13.49,0,0,1,7.1,1.83l-1.42,3.14a8.42,8.42,0,0,0-4.63-1.45c-2.8,0-4.53,1.69-4.53,3.62,0,5.64,11.32,3.14,11.32,11.6,0,4-3.85,7.9-9.89,7.9"/>
            </g>
        </svg>
    

        
    
                            </div>
                        
                    </div>
                    
                </div>
                
                
            </div>
        </div>
    </footer>


                    
                
            </div>
            
        

        
            
        

        <script>
            (function() {
                var s = 'https://cdn.ons.gov.uk/sdc/design-system/62.0.0/scripts/main.js'.split(','),
                c = document.createElement('script');

                if (!('noModule' in c)) {
                    for (var i = 0; i < s.length; i++) {
                        s[i] = s[i].replace('.js', '.es5.js');
                    }
                }

                for (var i = 0; i < s.length; i++) {
                    var e = document.createElement('script');

                    e.src = s[i];

                    document.body.appendChild(e);
                }
            })();
        </script>

        
    </body>
</html>